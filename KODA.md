# winLoadXRAY - Документация проекта

## Обзор проекта

**winLoadXRAY** — это Python GUI-приложение для Windows 10/11, представляющее собой удобную обертку вокруг ядра [XRAY](https://github.com/XTLS/Xray-core) для работы с прокси-соединениями и VPN. Приложение также интегрировано с [tun2proxy](https://github.com/tun2proxy/tun2proxy) для поддержки TUN-режима.

### Основные возможности

- **Поддержка протоколов**: VLESS (raw reality, xhttp reality), Shadowsocks, xhttp reality в режиме auto
- **Парсинг конфигураций**: Подписки, прямые vless:// и ss:// ссылки, чистые конфигурации XRAY
- **Типы запуска**: SOCKS5 прокси на порту 2080, системный прокси (рекомендуется для браузеров), TUN режим (требует админских прав)
- **Дополнительные функции**: Автозапуск, проверка обновлений, работа с буфером обмена, управление конфигурациями

### Архитектура

Проект имеет модульную структуру с разделением логики по функциональным модулям:

```
winLoadXRAY/
├── winLoadXRAY.py          # Главный файл приложения (GUI)
├── func/                   # Модули функциональности
│   ├── configXray.py       # Генерация конфигураций XRAY
│   ├── parsing.py          # Парсинг URL и конфигураций
│   ├── tun2proxy.py        # Управление TUN-режимом
│   └── copyPast.py         # Функции работы с буфером обмена
├── img/                    # Ресурсы интерфейса (иконки, изображения)
├── xray/                   # Исполняемые файлы XRAY (внешние)
├── tun2proxy/              # Исполняемые файлы tun2proxy (внешние)
├── README.md               # Документация
└── LICENSE                 # MIT лицензия
```

## Технологический стек

### Основные зависимости
- **Python 3.x** — основной язык разработки
- **tkinter** — библиотека GUI (входит в стандартную поставку Python)
- **PIL (Pillow)** — обработка изображений для интерфейса
- **requests** — HTTP-запросы для загрузки подписок и проверки обновлений

### Внешние компоненты
- **XRAY Core** — ядро прокси/VPN функциональности
- **tun2proxy** — инструмент для TUN-режима
- **PyInstaller** — для сборки исполняемого файла

## Файловая структура и назначение

### Основные файлы

#### `winLoadXRAY.py`
Главный файл приложения, содержащий:
- GUI интерфейс на tkinter
- Логику управления состоянием приложения
- Интеграцию всех модулей
- Обработку пользовательских действий

**Ключевые функции:**
- `run_selected()` — запуск выбранной конфигурации XRAY
- `toggle_system_proxy()` — управление системным прокси Windows
- `vrv_tun_mode_toggle()` — переключение TUN-режима
- `add_from_url()` — парсинг и загрузка конфигураций
- `check_latest_version()` — проверка обновлений на GitHub

#### `func/configXray.py`
Модуль генерации конфигураций XRAY:
- `generate_config(data)` — создание JSON конфигурации на основе распарсенных данных
- Поддержка VLESS и Shadowsocks протоколов
- Настройка маршрутизации для российских доменов (direct)
- Блокировка рекламы и систем Windows

#### `func/parsing.py`
Модуль парсинга URL и конфигураций:
- `parse_vless(url)` — парсинг VLESS ссылок с поддержкой всех параметров
- `parse_shadowsocks(url)` — парсинг Shadowsocks ссылок
- `sanitize_filename(name)` — очистка имен файлов от недопустимых символов

#### `func/tun2proxy.py`
Модуль управления TUN-режимом:
- `get_default_interface()` — определение сетевого интерфейса по умолчанию
- `start_tun2proxy()` — запуск tun2proxy с настройкой DNS
- `stop_tun2proxy()` — корректная остановка TUN-режима
- `patch_direct_out_interface()` — модификация конфигураций для работы с TUN

#### `func/copyPast.py`
Модуль работы с буфером обмена:
- `cmd_copy()`, `cmd_paste()`, `cmd_cut()`, `cmd_select_all()` — стандартные операции
- Горячие клавиши: Ctrl+V (вставка с автоматической обработкой), Ctrl+C, Ctrl+X, Ctrl+A

## Установка и запуск

### Системные требования
- Windows 10/11
- Python 3.x (для разработки)
- Права администратора (для TUN-режима)

### Установка зависимостей
```bash
pip install pillow requests pyinstaller
```

### Подготовка внешних компонентов

1. **XRAY Core**: Скачать последнюю версию [XRAY для Windows64](https://github.com/XTLS/Xray-core/releases) и разместить в папке `xray/`

2. **tun2proxy**: Скачать последнюю версию [tun2proxy](https://github.com/tun2proxy/tun2proxy/releases) и разместить в папке `tun2proxy/`

### Запуск приложения
```bash
cd C:\Xray-windows-64
python winLoadXRAY.py
```

### Автозапуск
Приложение поддерживает автоматический запуск вместе с Windows через настройку в реестре `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`.

## Сборка исполняемого файла

Для создания standalone исполняемого файла используется PyInstaller:

```bash
pyinstaller --onefile --windowed --icon=img/icon.ico \
  --add-binary "xray/xray.exe;xray" \
  --add-binary "xray/geoip.dat;xray" \
  --add-binary "xray/geosite.dat;xray" \
  --add-data "img/ico.png;img" \
  --add-data "img/ref.png;img" \
  --add-data "img/icon.ico;img" \
  --add-data "img/logo.png;img" \
  --add-data "tun2proxy/tun2proxy-bin.exe;tun2proxy" \
  --add-data "tun2proxy/tun2proxy.dll;tun2proxy" \
  --add-data "tun2proxy/wintun.dll;tun2proxy" \
  --add-data "tun2proxy/udpgw-server.exe;tun2proxy" \
  --add-data "func;func" \
  winLoadXRAY.py
```

## Конфигурация и настройки

### Структура данных приложения

Приложение хранит данные в директории `%APPDATA%\winLoadXRAY\configs\`:

- **Конфигурации**: JSON файлы с настройками XRAY
- **links.json**: URL подписок и ссылок
- **state.json**: Состояние приложения (активный конфиг, статус прокси)

### Поддерживаемые форматы

1. **Прямые ссылки**:
   - `vless://[uuid]@[server]:[port]?params#tag`
   - `ss://[method]:[password]@[server]:[port]#tag`

2. **Подписки**: HTTPS ссылки на base64-encoded списки конфигураций

3. **JSON конфигурации**: Прямой импорт JSON конфигураций XRAY

### Маршрутизация

Приложение включает предустановленные правила маршрутизации:
- **Реклама и шпионское ПО**: блокировка
- **Российские домены**: direct (обход прокси)
- **Системные сервисы**: direct (Apple, Microsoft, Windows Update)
- **BitTorrent**: direct
- **Habr.com**: через прокси

## Интерфейс пользователя

### Основные элементы

- **Поле ввода**: Для вставки URL подписок или конфигураций
- **Список конфигураций**: Отображение доступных конфигураций с подсветкой активной
- **Кнопка "Запустить конфиг"**: Управление XRAY процессом
- **Кнопка "Системный прокси"**: Переключение системного прокси Windows
- **Чекбокс "Автозапуск"**: Настройка автозапуска с Windows
- **Кнопка "TUN режим"**: Управление TUN-режимом (требует админских прав)

### Горячие клавиши

- **Enter**: В поле ввода — загрузка конфигурации, в списке — запуск/остановка
- **Ctrl+V**: Вставка из буфера с автоматической обработкой
- **Ctrl+C/X/A**: Копирование, вырезание, выделение всего

### Визуальные индикаторы

- **Зеленая подсветка**: Активная конфигурация
- **Оранжевая кнопка**: Включен системный прокси
- **Красная кнопка TUN**: Активный TUN-режим
- **Синяя ссылка**: Доступно обновление приложения

## Особенности реализации

### Безопасность

- Проверка прав администратора для TUN-режима
- Валидация входных данных при парсинге URL
- Безопасная работа с реестром Windows
- Обработка исключений во всех критических операциях

### Производительность

- Асинхронная проверка обновлений (через 3 секунды после запуска)
- Кэширование конфигураций в файловой системе
- Ленивая загрузка модулей функциональности
- Эффективное управление процессами XRAY и tun2proxy

### Совместимость

- Поддержка Windows 10/11
- Работа с различными форматами подписок
- Совместимость с разными версиями XRAY Core
- Поддержка Unicode в именах конфигураций

## Разработка и расширение

### Добавление новых протоколов

Для добавления поддержки нового протокола необходимо:

1. Добавить функцию парсинга в `func/parsing.py`
2. Обновить `func/configXray.py` для генерации соответствующей конфигурации
3. Добавить обработку в `winLoadXRAY.py`

### Модификация маршрутизации

Правила маршрутизации находятся в функции `generate_config()` в файле `func/configXray.py`. Можно добавлять новые правила в секцию `routing.rules`.

### Настройка интерфейса

GUI создается в конце файла `winLoadXRAY.py`. Интерфейс использует tkinter с кастомными стилями и ToolTip подсказками.

## Лицензия и авторские права

Проект распространяется под [MIT License](LICENSE). Автор: xVRVx (2025).

## Ссылки и ресурсы

- **GitHub репозиторий**: https://github.com/xVRVx/winLoadXRAY/
- **Telegram бот**: https://t.me/SkyBridge_VPN_bot
- **XRAY Core**: https://github.com/XTLS/Xray-core
- **tun2proxy**: https://github.com/tun2proxy/tun2proxy

## Известные ограничения

1. **TUN-режим**: Требует прав администратора и может конфликтовать с другими VPN-клиентами
2. **Системный прокси**: Работает только для браузеров, не затрагивает системные приложения
3. **DNS**: В TUN-режиме используется DoH (DNS over HTTPS) через Google и Cloudflare
4. **Автозапуск**: Приложение должно быть запущено с правами администратора для корректной работы всех функций